#!/usr/bin/env ruby
require_relative "../lib/rcat"

def parse_options(argv, display)
  files = OptionParser.new do |parser|

    parser.on("-n", "Print line numbers for every line") {
      display.enable_numbering
    }

    parser.on("-b", "Print line numbers for all except blank lines") {
      display.enable_significant_numbering
    }

    parser.on("-s", "Ignore multiple blank lines") {
      display.enable_squeeze
    }
  end.parse(argv)

  files
rescue OptionParser::InvalidOption => err
  abort "rcat: #{err.message}\nusage: rcat [-bns] [file ...]"
end

begin
  display = RCat::Display.new
  files = parse_options(ARGV, display)

  if files.empty?
    display.render(STDIN)
  else
    files.each do |filename|
      File.open(filename) { |f| display.render(f) }
    end
  end
rescue Errno::ENOENT => err
  abort "rcat: #{err.message}"
end

